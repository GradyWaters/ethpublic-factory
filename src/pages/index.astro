---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
const sorted = posts.sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate));
const hero = sorted[0];
const sidebar = sorted.slice(1, 5);
const grid = sorted.slice(1, 4);
---
<BaseLayout title="EthPublic — Ethereum News & Guides">
  <style>
    .hero { display:grid; grid-template-columns:1fr 360px; gap:40px; margin-bottom:48px; padding-bottom:48px; border-bottom:1px solid var(--border); }
    .hero-main { border-right:1px solid var(--border); padding-right:40px; }
    .hero-tag { font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--accent); text-transform:uppercase; letter-spacing:2px; margin-bottom:16px; display:flex; align-items:center; gap:8px; }
    .hero-tag::before { content:''; display:inline-block; width:6px; height:6px; background:var(--accent); border-radius:50%; animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .hero-title { font-family:'Playfair Display',serif; font-size:44px; font-weight:900;
    .hero-title a:hover { color:var(--accent); }
    .hero-excerpt { font-size:16px; color:#b0b0c8; line-height:1.7; margin-bottom:20px; }
    .hero-meta { font-size:12px; color:var(--gray); font-family:'IBM Plex Mono',monospace; display:flex; gap:12px; }
    .sidebar-label { font-family:'IBM Plex Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:2px; color:var(--gray); border-bottom:1px solid var(--border); padding-bottom:12px; margin-bottom:20px; }
    .sidebar-post { padding:16px 0; border-bottom:1px solid var(--border); }
    .sidebar-cat { font-family:'IBM Plex Mono',monospace; font-size:10px; color:var(--accent); text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
    .sidebar-title { font-size:15px; font-weight:600; line-height:1.4; margin-bottom:6px; }
    .sidebar-title a:hover { color:var(--accent); }
    .sidebar-date { font-size:12px; color:var(--gray); font-family:'IBM Plex Mono',monospace; }
    .section-header { display:flex; align-items:center; gap:16px; margin-bottom:28px; }
    .section-header h2 { font-family:'IBM Plex Mono',monospace; font-size:11px; text-transform:uppercase; letter-spacing:3px; color:var(--gray); white-space:nowrap; }
    .section-line { flex:1; height:1px; background:var(--border); }
    .articles-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:24px; margin-bottom:48px; }
    .article-card { background:var(--card); border:1px solid var(--border); border-radius:8px; overflow:hidden; transition:border-color 0.2s,transform 0.2s; }
    .article-card:hover { border-color:var(--accent); transform:translateY(-2px); }
    .card-thumb { height:140px; background:linear-gradient(135deg,#12122a,#1a1a3e); display:flex; align-items:center; justify-content:center; }
    .card-body { padding:20px; }
    .card-cat { font-family:'IBM Plex Mono',monospace; font-size:10px; color:var(--accent); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
    .card-title { font-family:'Playfair Display',serif; font-size:17px; font-weight:700; line-height:1.3; margin-bottom:10px; }
    .card-title a:hover { color:var(--accent); }
    .card-excerpt { font-size:13px; color:#8888a0; line-height:1.6; margin-bottom:12px; }
    .card-meta { font-family:'IBM Plex Mono',monospace; font-size:11px; color:var(--gray); }
    .service-banner { background:linear-gradient(135deg,#0f1a3d,#162040); border:1px solid #2a3a6e; border-radius:12px; padding:36px 40px; display:flex; align-items:center; justify-content:space-between; gap:24px; margin-bottom:40px; }
    .service-text h3 { font-family:'Playfair Display',serif; font-size:24px; font-weight:700; margin-bottom:8px; }
    .service-text p { color:#8888a0; font-size:14px; max-width:480px; }
    .service-btn { background:var(--accent); color:var(--white); padding:14px 28px; border-radius:6px; font-weight:600; font-size:15px; white-space:nowrap; }
    .service-btn:hover { background:#7b93f5; }
  </style>

  {hero && (
    <div class="hero">
      <div class="hero-main">
        <div class="hero-tag">Latest News</div>
        <h1 class="hero-title"><a href={`/guides/${hero.slug}`}>{hero.data.title}</a></h1>
        <p class="hero-excerpt">{hero.data.description}</p>
        <div class="hero-meta">
          <span>{new Date(hero.data.pubDate).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</span>
          <span>·</span>
          <span>{hero.data.category}</span>
        </div>
      </div>
      <div class="hero-sidebar">
        <div class="sidebar-label">Latest Stories</div>
        {sidebar.map(post => (
          <div class="sidebar-post">
            <div class="sidebar-cat">{post.data.category}</div>
            <div class="sidebar-title"><a href={`/guides/${post.slug}`}>{post.data.title}</a></div>
            <div class="sidebar-date">{new Date(post.data.pubDate).toLocaleDateString('en-US', {month:'short', day:'numeric'})}</div>
          </div>
        ))}
      </div>
    </div>
  )}

  <div class="section-header">
    <h2>Recent Articles</h2>
    <div class="section-line"></div>
  </div>

  <div class="articles-grid">
    {grid.map(post => (
      <div class="article-card">
        <div class="card-thumb">
          <svg width="50" height="50" viewBox="0 0 50 50" opacity="0.4">
            <polygon points="25,4 46,25 25,35 4,25" fill="none" stroke="#627eea" stroke-width="1.5"/>
            <polygon points="25,35 46,25 25,46 4,25" fill="none" stroke="#627eea" stroke-width="1"/>
          </svg>
        </div>
        <div class="card-body">
          <div class="card-cat">{post.data.category}</div>
          <div class="card-title"><a href={`/guides/${post.slug}`}>{post.data.title}</a></div>
          <div class="card-excerpt">{post.data.description}</div>
          <div class="card-meta">{new Date(post.data.pubDate).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</div>
        </div>
      </div>
    ))}
  </div>

  <div class="service-banner">
    <div class="service-text">
      <h3>Need Help Setting Up Your Wallet?</h3>
      <p>Book a private 1-on-1 session with Jon. We'll set up your wallet together on a live Zoom call — no jargon, no pressure, just a safe setup done right.</p>
    </div>
    <a href="/services" class="service-btn">Book a Session →</a>
  </div>
</BaseLayout>
